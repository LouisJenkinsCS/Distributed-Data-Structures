

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>DistributedBag &mdash; chpldoc 0.0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="chpldoc 0.0.1 documentation" href="../../index.html"/>
        <link rel="next" title="DistributedDeque" href="DistributedDeque.html"/>
        <link rel="prev" title="Collection" href="Collection.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> chpldoc
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">chpldoc documentation</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Collection.html">Collection</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">DistributedBag</a></li>
<li class="toctree-l1"><a class="reference internal" href="DistributedDeque.html">DistributedDeque</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">chpldoc</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
    <li>DistributedBag</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/modules/collections/DistributedBag.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <span class="target" id="module-DistributedBag"></span><div class="section" id="distributedbag">
<h1>DistributedBag<a class="headerlink" href="#distributedbag" title="Permalink to this headline">¶</a></h1>
<p><strong>Usage</strong></p>
<div class="highlight-chapel"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">DistributedBag</span><span class="p">;</span>
</pre></div>
</div>
<dl class="data">
<dt id="DistributedBag.distributedBagInitialBlockSize">
<em class="property">config param </em><code class="descname">distributedBagInitialBlockSize</code> = 1024<a class="headerlink" href="#DistributedBag.distributedBagInitialBlockSize" title="Permalink to this definition">¶</a></dt>
<dd><p>The initial amount of elements in an unroll block. Each successive unroll block
is double the size of it&#8217;s predecessor, allowing for better locality for when
there are larger numbers of elements. The better the locality, the better raw
performance and easier it is to redistribute work.</p>
</dd></dl>

<dl class="data">
<dt id="DistributedBag.distributedBagWorkStealingRatio">
<em class="property">config param </em><code class="descname">distributedBagWorkStealingRatio</code> = 0.25<a class="headerlink" href="#DistributedBag.distributedBagWorkStealingRatio" title="Permalink to this definition">¶</a></dt>
<dd><p>To prevent stealing too many elements (horizontally) from another node&#8217;s segment
(hence creating an artifical load imbalance), if the other node&#8217;s segment has
less than a certain threshold (see <cite>distributedBagWorkStealingMemCap</cite>) but above
another threshold (see <cite>distributedBagWorkStealingMinElems</cite>), we steal a percentage of their
elements, leaving them with majority of their elements. This way, the amount the
other segment loses is proportional to how much it owns, ensuring a balance.</p>
</dd></dl>

<dl class="data">
<dt id="DistributedBag.distributedBagWorkStealingMemCap">
<em class="property">config param </em><code class="descname">distributedBagWorkStealingMemCap</code>: real = 1.0<a class="headerlink" href="#DistributedBag.distributedBagWorkStealingMemCap" title="Permalink to this definition">¶</a></dt>
<dd><p>The maximum amount of work to steal from a horizontal node&#8217;s segment. This
should be set to a value, in megabytes, that determines the maximum amount of
data that should be sent in bulk at once. The maximum number of elements is
determined by: (distributedBagWorkStealingMemCap * 1024 * 1024) / sizeof(eltType).
For example, if we are storing 8-byte integers and have a 1MB limit, we would
have a maximum of 125,000 elements stolen at once.</p>
</dd></dl>

<dl class="data">
<dt id="DistributedBag.distributedBagWorkStealingMinElems">
<em class="property">config param </em><code class="descname">distributedBagWorkStealingMinElems</code> = 1<a class="headerlink" href="#DistributedBag.distributedBagWorkStealingMinElems" title="Permalink to this definition">¶</a></dt>
<dd><p>The minimum number of elements a horizontal segment must have to become eligible
to be stolen from. This may be useful if some segments produce less elements than
others and should not be stolen from.</p>
</dd></dl>

<dl class="class">
<dt id="DistributedBag.DistributedBag">
<em class="property">class </em><code class="descname">DistributedBag</code>: Collection<a class="headerlink" href="#DistributedBag.DistributedBag" title="Permalink to this definition">¶</a></dt>
<dd><p>A parallel-safe distributed multiset implementation that scales in terms of
nodes, processors per node (PPN), and workload; The more PPN, the more segments
we allocate to increase raw parallelism, and the larger the workload the better
locality (see <cite>distributedBagInitialBlockSize</cite>). This data structure is unordered and employs
its own work-stealing algorithm, and provides a means to obtain a privatized instance of
the data structure for maximized performance.</p>
<dl class="attribute">
<dt id="DistributedBag.DistributedBag.targetLocales">
<em class="property">var </em><code class="descname">targetLocales</code>: [targetLocDom] locale<a class="headerlink" href="#DistributedBag.DistributedBag.targetLocales" title="Permalink to this definition">¶</a></dt>
<dd><p>The locales to allocate bags for and load balance across.</p>
</dd></dl>

<dl class="method">
<dt id="DistributedBag.DistributedBag.DistributedBag">
<em class="property">proc </em><code class="descname">DistributedBag</code><span class="sig-paren">(</span><em>type eltType</em>, <em>targetLocales: [?targetLocDom] locale = Locales</em><span class="sig-paren">)</span><a class="headerlink" href="#DistributedBag.DistributedBag.DistributedBag" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="DistributedBag.DistributedBag.getPrivatizedInstance">
<em class="property">proc </em><code class="descname">getPrivatizedInstance</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#DistributedBag.DistributedBag.getPrivatizedInstance" title="Permalink to this definition">¶</a></dt>
<dd><p>Obtains a privatized version of this instance. The privatized version is a
cloned instance that is allocated on this node, which is useful for eliding
communications generated from accessing instance fields. Using another node&#8217;s
instance will significantly penalize performance by bounding overall throughput
on the communication between the two nodes.</p>
</dd></dl>

<dl class="method">
<dt id="DistributedBag.DistributedBag.add">
<em class="property">proc </em><code class="descname">add</code><span class="sig-paren">(</span><em>elt: eltType</em><span class="sig-paren">)</span>: bool<a class="headerlink" href="#DistributedBag.DistributedBag.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert an element to this node&#8217;s bag. The ordering is not guaranteed to be
preserved.</p>
</dd></dl>

<dl class="method">
<dt id="DistributedBag.DistributedBag.remove">
<em class="property">proc </em><code class="descname">remove</code><span class="sig-paren">(</span><span class="sig-paren">)</span>: (bool, eltType)<a class="headerlink" href="#DistributedBag.DistributedBag.remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove an element from this node&#8217;s bag. The order in which elements are removed
are not guaranteed to be the same order it has been inserted. If this node&#8217;s
bag is empty, it will attempt to steal elements from bags of other nodes.</p>
</dd></dl>

<dl class="method">
<dt id="DistributedBag.DistributedBag.getSize">
<em class="property">proc </em><code class="descname">getSize</code><span class="sig-paren">(</span><span class="sig-paren">)</span>: int<a class="headerlink" href="#DistributedBag.DistributedBag.getSize" title="Permalink to this definition">¶</a></dt>
<dd><p>Obtain the number of elements held in all bags across all nodes. This method
is best-effort and can be non-deterministic for concurrent updates across nodes,
and may miss elements or even count duplicates resulting from any concurrent
insertion or removal operations.</p>
</dd></dl>

<dl class="method">
<dt id="DistributedBag.DistributedBag.contains">
<em class="property">proc </em><code class="descname">contains</code><span class="sig-paren">(</span><em>elt: eltType</em><span class="sig-paren">)</span>: bool<a class="headerlink" href="#DistributedBag.DistributedBag.contains" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a lookup to determine if the requested element exists in this bag.
This method is best-effort and can be non-deterministic for concurrent
updates across nodes, and may miss elements resulting from any concurrent
insertion or removal operations.</p>
</dd></dl>

<dl class="method">
<dt id="DistributedBag.DistributedBag.clear">
<em class="property">proc </em><code class="descname">clear</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#DistributedBag.DistributedBag.clear" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear all bags across all nodes in a best-effort approach. Elements added or
moved around from concurrent additions or removals may be missed while clearing.</p>
</dd></dl>

<dl class="method">
<dt id="DistributedBag.DistributedBag.balance">
<em class="property">proc </em><code class="descname">balance</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#DistributedBag.DistributedBag.balance" title="Permalink to this definition">¶</a></dt>
<dd><p>Triggers a more static approach to load balancing, fairly redistributing all
elements fairly for bags across nodes. The result will result in all segments
having roughly the same amount of elements.</p>
<p><strong>Note:</strong> This method is very heavy-weight in that it should not be called too
often. Dynamic work stealing handles cases where there is a relatively fair
distribution across majority of nodes, but this should be called when you have
a severe imbalance, or when you have a smaller number of elements to balance.
Furthermore, while this operation is parallel-safe, it should be called in a
sequential context.</p>
</dd></dl>

<dl class="itermethod">
<dt id="DistributedBag.DistributedBag.these">
<em class="property">iter </em><code class="descname">these</code><span class="sig-paren">(</span><span class="sig-paren">)</span>: eltType<a class="headerlink" href="#DistributedBag.DistributedBag.these" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate over each bag in each node. To avoid holding onto locks, we take
a snapshot approach, increasing memory consumption but also increasing parallelism.
This allows other concurrent, even mutating, operations while iterating,
but opens the possibility to iterating over duplicates or missing elements
from concurrent operations.</p>
<p><strong>Warning:</strong> Breaking from an iterator will leak the snapshot due to issue #6912.
It will however leave all Bags in a safe state.</p>
</dd></dl>

<dl class="itermethod">
<dt>
<em class="property">iter </em><code class="descname">these</code><span class="sig-paren">(</span><em>param tag: iterKind</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

<dl class="itermethod">
<dt>
<em class="property">iter </em><code class="descname">these</code><span class="sig-paren">(</span><em>param tag: iterKind</em>, <em>followThis</em><span class="sig-paren">)</span></dt>
<dd></dd></dl>

</dd></dl>

</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="DistributedDeque.html" class="btn btn-neutral float-right" title="DistributedDeque" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Collection.html" class="btn btn-neutral" title="Collection" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, .

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 



</body>
</html>